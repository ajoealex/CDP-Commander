<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      width: 600px;
      max-width: 100%;
      min-width: 600px;
      padding: 15px;
      margin: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      font-size: 14px;
    }

    /* Responsive layout for window mode */
    body.window-mode {
      width: 100%;
      max-width: 100%;
      min-width: 320px;
      margin: 0 auto;
    }

    /* Side panel or narrow screens */
    @media (max-width: 700px) {
      body,
      body.window-mode {
        padding: 10px;
      }
    }

    /* Mobile or very narrow */
    @media (max-width: 400px) {
      body,
      body.window-mode {
        padding: 8px;
        font-size: 13px;
      }
    }

    .developer-badge {
      display: inline-block;
      background-color: #1c7fe1;
      color: white;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    .header-controls {
      margin-bottom: 15px;
    }

    h3 {
      margin: 0 0 10px 0;
      color: #333;
    }

    @media (max-width: 500px) {
      h3 {
        font-size: 16px;
      }
    }

    .terminate-section {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .terminate-btn {
      padding: 8px 16px;
      background-color: #dc2626;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 8px;
      font-weight: 500;
      width: auto;
      white-space: nowrap;
    }

    .terminate-btn:hover {
      background-color: #b91c1c;
    }

    @media (max-width: 500px) {
      .terminate-btn {
        font-size: 8px;
        padding: 6px 12px;
      }
    }

    .progress-container {
      width: 100%;
      height: 4px;
      background-color: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      margin-top: 8px;
      display: none;
    }

    .progress-container.show {
      display: block;
    }

    .progress-bar {
      height: 100%;
      background-color: #dc2626;
      width: 0%;
      transition: width 0.1s linear;
    }

    .section {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }

    select,
    input,
    textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: inherit;
      font-size: 13px;
    }

    .autocomplete-wrapper {
      position: relative;
      width: 100%;
    }

    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 200px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 4px 4px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 1000;
    }

    .autocomplete-list.show {
      display: block;
    }

    .autocomplete-item {
      padding: 8px 12px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    .autocomplete-item:last-child {
      border-bottom: none;
    }

    .autocomplete-item:hover,
    .autocomplete-item.active {
      background-color: #f0f7ff;
    }

    .autocomplete-item .method-domain {
      color: #4285f4;
      font-weight: 600;
    }

    .autocomplete-item .method-name {
      color: #333;
    }

    textarea {
      font-family: 'Courier New', monospace;
      min-height: 100px;
      resize: vertical;
    }

    button {
      background-color: #4285f4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      width: 100%;
    }

    button:hover {
      background-color: #357ae8;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    @media (max-width: 400px) {
      button {
        padding: 8px 16px;
        font-size: 13px;
      }
    }

    .refresh-btn {
      background-color: #34a853;
      margin-bottom: 10px;
    }

    .refresh-btn:hover {
      background-color: #2d9049;
    }

    #result {
      margin-top: 15px;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .error {
      background-color: #fef2f2;
      color: #dc2626;
      border: 1px solid #fca5a5;
    }

    .success {
      background-color: #f0fdf4;
      color: #16a34a;
      border: 1px solid #86efac;
    }

    .loading {
      text-align: center;
      color: #666;
      padding: 20px;
    }

    #frameSelect option {
      padding: 5px;
    }

    /* Monitor Panel Styles */
    .monitor-section {
      border-top: 2px solid #ddd;
      padding-top: 20px;
      margin-top: 20px;
    }

    .monitor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .monitor-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    @media (max-width: 500px) {
      .monitor-controls {
        gap: 8px;
      }
    }

    .filter-group {
      display: flex;
      gap: 5px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 6px 12px;
      background-color: #f5f5f5;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      width: auto;
    }

    .filter-btn:hover {
      background-color: #e8e8e8;
    }

    .filter-btn.active {
      background-color: #4285f4;
      color: white;
      border-color: #4285f4;
    }

    .pause-btn {
      background-color: #f59e0b;
      border-color: #d97706;
      color: #fff;
      white-space: nowrap;
    }

    .pause-btn.paused {
      background-color: #dc2626;
      border-color: #b91c1c;
      color: #fff;
    }

    .search-box {
      flex: 1;
      min-width: 200px;
    }

    @media (max-width: 500px) {
      .search-box {
        min-width: 100%;
        order: 3;
      }

      .filter-group {
        flex: 1 0 100%;
      }
    }

    .export-btn {
      padding: 6px 12px;
      background-color: #16a34a;
      width: auto;
      font-size: 12px;
    }

    .export-btn:hover {
      background-color: #15803d;
    }

    .clear-btn {
      padding: 6px 12px;
      background-color: #dc2626;
      width: auto;
      font-size: 12px;
    }

    .clear-btn:hover {
      background-color: #b91c1c;
    }

    #messageLog {
      border: 1px solid #ddd;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
      background-color: #fff;
    }

    .message-row {
      padding: 8px 12px;
      border-bottom: 1px solid #f0f0f0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    @media (max-width: 500px) {
      .message-row {
        padding: 6px 8px;
        font-size: 11px;
      }
    }

    .message-row:hover {
      background-color: #f9fafb;
    }

    .message-row:last-child {
      border-bottom: none;
    }

    .message-row.outgoing {
      background-color: #fef3c7;
    }

    .message-row.incoming {
      background-color: #dbeafe;
    }

    .message-row.error {
      background-color: #fee2e2;
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .message-direction {
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      text-transform: uppercase;
    }

    .message-direction.outgoing {
      background-color: #fbbf24;
      color: #78350f;
    }

    .message-direction.incoming {
      background-color: #60a5fa;
      color: #1e3a8a;
    }

    .message-timestamp {
      color: #666;
      font-size: 11px;
    }

    .message-method {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 4px;
    }

    .message-params {
      color: #4b5563;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .message-detail {
      display: none;
      margin-top: 8px;
      padding: 8px;
      background-color: #f9fafb;
      border-radius: 4px;
      border: 1px solid #e5e7eb;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .message-row.expanded .message-detail {
      display: block;
    }

    .copy-json-btn {
      margin-bottom: 8px;
      padding: 6px 12px;
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      width: auto;
      display: inline-block;
    }

    .copy-json-btn:hover {
      background-color: #357ae8;
    }

    .copy-json-btn:active {
      background-color: #2a5bb8;
    }

    .empty-log {
      text-align: center;
      padding: 40px 20px;
      color: #9ca3af;
    }

    .dock-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .dock-label {
      font-weight: 500;
      color: #555;
      margin-right: 5px;
    }

    .dock-btn {
      padding: 8px 12px;
      background-color: #f5f5f5;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      width: auto;
      flex: 0 1 auto;
    }

    .dock-btn:hover {
      background-color: #e8e8e8;
      border-color: #bbb;
    }

    .dock-btn svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    /* Bulk command mode styles */
    .mode-toggle-container {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
      gap: 10px;
      align-items: center;
    }

    .mode-toggle-btn {
      padding: 6px 12px;
      background-color: #f5f5f5;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      width: auto;
    }

    .mode-toggle-btn:hover {
      background-color: #e8e8e8;
    }

    .mode-toggle-btn.active {
      background-color: #4285f4;
      color: white;
      border-color: #4285f4;
    }

    #bulkCommandInput {
      font-family: 'Courier New', monospace;
      min-height: 200px;
      resize: vertical;
    }


    .bulk-progress {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f7ff;
      border-radius: 4px;
      border: 1px solid #4285f4;
      display: none;
      font-size: 12px;
    }

    .bulk-progress.show {
      display: block;
    }

    .bulk-progress-text {
      color: #333;
      margin-bottom: 5px;
    }

    /* Hide dock controls in window mode */
    body.window-mode .dock-controls {
      display: none;
    }

    /* Side panel mode: only show "Open in Window" */
    body.sidepanel-mode .dock-label,
    body.sidepanel-mode #dockRightBtn {
      display: none;
    }

    body.sidepanel-mode .dock-controls {
      justify-content: flex-end;
    }

    /* Responsive dock controls */
    @media (max-width: 500px) {
      .dock-controls {
        gap: 8px;
      }

      .dock-label {
        width: 100%;
        margin-bottom: 5px;
      }

      .dock-btn {
        flex: 1 1 calc(50% - 4px);
        justify-content: center;
        font-size: 12px;
        padding: 8px;
      }
    }
  </style>
</head>

<body>
  <div class="developer-badge">âš  For Developers Only</div>

  <div class="header-controls">
    <h3>CDP Commander</h3>
    <div class="terminate-section">
      <button id="terminateBtn" class="terminate-btn" title="Terminate all CDP sessions">Terminate All CDP
        Sessions</button>
      <div id="terminateProgress" class="progress-container">
        <div id="terminateProgressBar" class="progress-bar"></div>
      </div>
    </div>
  </div>

  <div class="dock-controls">
    <span class="dock-label">Dock Side:</span>
    <button id="dockRightBtn" class="dock-btn" title="Dock to right side">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" />
        <line x1="15" y1="3" x2="15" y2="21" />
      </svg>
      Dock to Right
    </button>
    <button id="openWindowBtn" class="dock-btn" title="Open in new window">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" />
        <path d="M9 3v18" />
        <path d="M15 3v18" />
      </svg>
      Open in Window
    </button>
  </div>

  <div class="section">
    <label>Select Tab:</label>
    <button id="refreshTabs" class="refresh-btn">Refresh Tabs</button>
    <select id="tabSelect">
      <option value="">Loading tabs...</option>
    </select>
  </div>

  <div class="section">
    <label>Select Frame:</label>
    <button id="refreshFrames" class="refresh-btn">Refresh Frames</button>
    <select id="frameSelect" size="5">
      <option value="">Select a tab first...</option>
    </select>
  </div>
  
  <div class="mode-toggle-container">
    <button id="toggleModeBtn" class="mode-toggle-btn" title="Switch to bulk command mode">Bulk Mode</button>
  </div>

  <!-- Single Command Mode -->
  <div id="singleCommandMode">
    <div class="section">
      <label for="methodInput">CDP Method:</label>
      <div class="autocomplete-wrapper">
        <input type="text" id="methodInput" placeholder="e.g., Runtime.evaluate" autocomplete="off" />
        <div id="autocompleteList" class="autocomplete-list"></div>
      </div>
    </div>

    <div class="section">
      <label for="paramsInput">Parameters (JSON):</label>
      <div style="display: flex; justify-content: flex-end; margin-bottom: 5px;">
        <button id="formatJsonBtn" class="filter-btn" style="font-size: 11px; padding: 4px 8px;" title="Format JSON">Format JSON</button>
      </div>
      <textarea id="paramsInput" placeholder='e.g., {"expression": "document.title"}'></textarea>
    </div>
  </div>

  <!-- Bulk Command Mode -->
  <div id="bulkCommandMode" style="display: none;">
    <div class="section">
      <label for="bulkCommandInput">Bulk Commands:</label>
      <textarea id="bulkCommandInput" placeholder="Enter multiple commands in the format:&#10;&#10;Network.enable&#10;{}&#10;&#10;Network.setExtraHTTPHeaders&#10;{&#10;  &quot;headers&quot;: {&#10;    &quot;test&quot;: &quot;test value&quot;&#10;  }&#10;}"></textarea>
    </div>
  </div>

  <button id="executeBtn">Execute CDP Command</button>

  <div id="bulkProgress" class="bulk-progress">
    <div class="bulk-progress-text" id="bulkProgressText">Executing commands...</div>
  </div>

  <div id="result"></div>
  
  <!-- Monitor Panel -->
  <div class="monitor-section">
    <div class="monitor-header">
      <h3>CDP Message Monitor</h3>
      <div style="display: flex; gap: 10px;">
        <button id="exportLog" class="export-btn">Export as JSON</button>
        <button id="clearLog" class="clear-btn">Clear Log</button>
      </div>
    </div>
    
    <div class="monitor-controls">
      <div class="filter-group">
        <button id="filterAll" class="filter-btn active">All</button>
        <button id="filterOutgoing" class="filter-btn">Outgoing</button>
        <button id="filterIncoming" class="filter-btn">Incoming</button>
      </div>
      <button id="toggleLogPause" class="filter-btn pause-btn" title="Temporarily stop rendering new log entries">Pause Log</button>
      <input type="text" id="searchBox" class="search-box" placeholder="Search method or params...">
    </div>
    
    <div id="messageLog">
      <div class="empty-log">No messages yet. Execute a CDP command to see it here.</div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
